rule:
  meta:
    name: detect socks incoming connection requests
    namespace: load-code
    authors:
      - chakrabortyarkaprabha998@gmail.com
    scopes:
      static: basic block
      dynamic: unsupported
    references:
      - https://github.com/rofl0r/microsocks
    features:
      - and:
        - os: linux
        - and:
          - basic block:
            - and:
                - mnemonic: mov
                - mnemonic: movzx
                - offset: 0x0
                - operand[1].offset: 0x0
                - mnemonic: cmp
                - number: 0x5
                - operand[1].number: 0x5
          - basic block:
            - and:
                - mnemonic: mov
                - mnemonic: add
                - number: 0x1
                - operand[1].number: 0x1
                - offset: 0x1
                - operand[1].offset: 0x1
                - mnemonic: movzx
                - offset: 0x0
                - operand[1].offset: 0x0
                - mnemonic: cmp
                - number: 0x1
                - operand[1].number: 0x1
            - basic block:
              - and:
                - mnemonic: mov
                - mnemonic: add
                - number: 0x2
                - operand[1].number: 0x2
                - offset: 0x2
                - operand[1].offset: 0x2
                - mnemonic: movzx
                - offset: 0x0
                - operand[1].offset: 0x0
                - mnemonic: test
            - basic block:
              - and:
                - mnemonic: mov
                - number: 0x2
                - operand[1].number: 0x2
              - and:
                - mnemonic: mov
                - number: 0xA
                - operand[1].number: 0xA
              - and:
                - mnemonic: mov
                - mnemonic: add
                - number: 0x3 
                - operand[1].number: 0x3
                - offset: 0x3
                - operand[1].offset: 0x3
                - mnemonic: movzx
                - offset: 0x0
                - operand[1].offset: 0x0
                - mnemonic: movzx
              - and:
                - or:
                  - and:
                    - mnemonic: cmp
                    - number: 0x4
                    - operand[1].number: 0x4
                    - basic block:
                      -  mnemonic: mov
                      -  number: 0xA
                      -  operand[1].number: 0xA
                      -  mnemonic: mov
                      -  number: 0x16
                      -  operand[1].number: 0x16
                    - basic block:
                      - api: inet_ntop
                      - mnemonic: call
                      - characteristic: (calls from) -> 0x20022D0
                  - and:
                    - mnemonic: cmp
                    - number: 0x1
                    - operand[1].number: 0x1
                    - basic block:
                      - api: inet_ntop
                      - mnemonic: call
                      - characteristic: (calls from) -> 0x20022D0
                  - and:
                    - mnemonic: cmp
                    - number: 0x3
                    - operand[1].number: 0x3
                    - basic block:
                      - mnemonic: mov
                      - mnemonic: add
                      - number: 0x4
                      - operand[1].number: 0x4
                      - offset: 0x4
                      - operand[1].offset: 0x4
  insn: 0x20027F9: mnemonic(movzx)
  insn: 0x20027F9: offset(0x0)
  insn: 0x20027F9: operand[1].offset(0x0)
  insn: 0x20027FC: mnemonic(movzx)
  insn: 0x20027FF: mnemonic(mov)
  insn: 0x2002806: mnemonic(mov)
  insn: 0x200280D: mnemonic(add)
  insn: 0x200280D: number(0x7)
  insn: 0x200280D: operand[1].number(0x7)
  insn: 0x200280D: offset(0x7)
  insn: 0x200280D: operand[1].offset(0x7)
  insn: 0x2002811: mnemonic(mov)
  insn: 0x2002818: mnemonic(mov)
  insn: 0x200281F: mnemonic(add)
  insn: 0x200281F: number(0x7)
  insn: 0x200281F: operand[1].number(0x7)
  insn: 0x200281F: offset(0x7)
  insn: 0x200281F: operand[1].offset(0x7)
  insn: 0x2002823: mnemonic(cmp)



